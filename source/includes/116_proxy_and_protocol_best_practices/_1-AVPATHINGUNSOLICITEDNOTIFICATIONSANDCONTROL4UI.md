## AV PATHING, UNSOLICITED NOTIFICATIONS AND CONTROL4 UI

Fundamentally, audio/video source/endpoint selection and pathing behavior in the Control4 system are expected to be under Control4’s control. Commands are expected to originate from the Control4 user interface. The user selects a source for playback in a certain room (as configured by the Control4 installer and automatically generated in the Control4 UI). When the user selects a source, the Control4 pathing algorithms dynamically select the best path from the selected source device to the audio/video endpoint(s) based on the connections configured by the Control4 installer. Drivers for the devices on the path are expected to handle the commands for on/off, source selection, input/output switching, etc. The drivers will receive commands and should send the proper notifications for each command received based on the Proxy/Protocol guide documentation.
 
Because of this architectural choice made by Control4, the system will ignore unsolicited notifications (or notifications for which no command was sent). If the user is controlling a specific device in the path (through physical buttons, 1st-party product remote, or product-specific app), even if the driver sends a notification to the Control4 system the changes will not be propagated back up to the Control4 UI. Control4 will not run the pathing algorithms in reverse to try to interpret what has just happened. And the Control4 UI will be out of sync with the actual device status. Therefore, we recommend that the Control4 user interface be used for source selection.

Likewise, because of the automatic pathing algorithms, Control4 discourages driver developers from trying to mimic the pathing functionality of the system by having their driver select other device(s). When it comes to devices selecting other devices, it’s best to simply not do so in the driver because the driver doesn’t have access to all of the information that the installer has configured when the system was installed.

If a driver developer decides to implement this type of functionality, for a specific use case, we recommend that they include a dealer setup method on the properties page where the dealer actually selects which source is connected to which input and use that, combined with the Room On room selector property, to choose the source in the right room.  This effectively replicates the programming the dealer would have to do on the programming page inside the driver and is a user-friendly way of doing this.  We have not done this on any driver of ours yet though, because the use case of source selection outside of Control4 is so low because of the source control aspect.

If used, this behavior should be select-able by the dealer though, and not always forced, as there are likely to be scenarios where different behavior than expected by the client/dealer will happen, even though it’s “correct”.

Please note, however, that the above restriction only applies to AV-type device drivers. This does not apply to other types of devices controlled within the Control4 environment. Drivers for security system integrations, blinds/shades, relays/sensors, thermostats, etc. will always send notifications of state changes and these will be tracked by the Control4 system regardless of whether or not the command to perform the action which resulted in the state change originated with the Control4 UI.